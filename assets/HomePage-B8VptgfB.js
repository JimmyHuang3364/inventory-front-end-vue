import{_ as Q,w as g,g as D,o as l,c,b as t,F as A,h as q,t as h,n as $,T as y,e as M,v as O,i as U,O as J,r as F,j as R,k as L,l as C,m as V,p as E,q as z,s as G}from"./index-hUmWNnQV.js";import{S as K,a as H}from"./swiper-vue-BhnIqiH8.js";import{p as B,w as T}from"./warehouse-BxBrKKoQ.js";import{p as X,P as Z}from"./production_process_items-CHWDWpN1.js";import{P as tt}from"./PageLoader-BPKjqbBE.js";const et={props:{initialPartNumbers:{type:Array}},created(){this.fetchInitialPartNumbers(this.initialPartNumbers),this.isLoading=!1},data(){return{partNumbers:[],isLoading:!0}},methods:{fetchInitialPartNumbers(s){this.partNumbers=s}},watch:{initialPartNumbers(s){this.fetchInitialPartNumbers(s)}}},st={class:"partnumbers_area"},it={class:"table table-sm table-hover table-bordered table-dark"},rt={key:0,style:{"background-color":"#b0b0b0","text-align":"center"}},nt={class:"text-dark",scope:"row"},at={class:"text-dark"},ot={class:"text-dark"},ut={key:1,style:{"background-color":"#182f8b","text-align":"center"}},lt={scope:"row"},ct={class:"text-dark",scope:"row"},ht={class:"text-dark"},dt={class:"text-dark"};function mt(s,e,n,o,r,u){return g((l(),c("div",st,[e[1]||(e[1]=t("h2",{class:"text-light"},"庫存總攬",-1)),t("table",it,[e[0]||(e[0]=t("thead",null,[t("tr",{class:"table-active",style:{"text-align":"center"}},[t("th",{scope:"col"},[t("h4",null,"品番")]),t("th",{scope:"col"},[t("h4",null,"在庫數量")]),t("th",{scope:"col"},[t("h4",null,"備註")]),t("th",{scope:"col"},[t("h4",null,"安全庫存")])])],-1)),(l(!0),c(A,null,q(r.partNumbers,i=>(l(),c("tbody",{key:i.id,style:{"border-top-width":"20px","border-color":"rgb(19, 19, 19)"}},[i.PartNumberId?(l(),c("tr",rt,[t("td",nt,h(i.name),1),t("td",{class:$([{"bg-danger":i.quantity<i.safetyStockQuantity},{"text-dark":i.quantity>=i.safetyStockQuantity}])},h(i.quantity),3),t("td",at,h(i.commonName),1),t("td",ot,h(i.safetyStockQuantity),1)])):(l(),c("tr",ut,[t("td",lt,h(i.name),1),t("td",{class:$([{"bg-danger":i.quantity<i.safetyStockQuantity}])},h(i.quantity),3),t("td",null,h(i.commonName),1),t("td",null,h(i.safetyStockQuantity),1)])),(l(!0),c(A,null,q(i.subPartNumbers,m=>(l(),c("tr",{key:m.id,style:{"text-align":"center","background-color":"#b0b0b0"}},[t("td",ct,h(m.name),1),t("td",{class:$([{"bg-danger text-white":m.quantity<m.safetyStockQuantity},{"text-dark":m.quantity>=m.safetyStockQuantity}])},h(m.quantity),3),t("td",ht,h(m.commonName),1),t("td",dt,h(m.safetyStockQuantity),1)]))),128))]))),128))])],512)),[[D,!r.isLoading]])}const pt=Q(et,[["render",mt]]),gt={inject:["reload"],props:{initialWarehousingHistories:{type:Array},initialIsShowFastShippingWarehousingFormArea:{type:Boolean},initialPartNumbers:{type:Array}},created(){this.fetchInitialWarehousingHistories(this.initialWarehousingHistories),this.fetchIsShowFastShippingWarehousingFormArea(this.initialIsShowFastShippingWarehousingFormArea),this.fetchInitialPartNumbers(this.initialPartNumbers),this.fetchSubPartNumbers(),this.fetchTodaysDate(),this.isLoading=!1},data(){return{newWarehousingOrShipping:{date:"",name:"",quantity:null,note:"",productId:"",isSubPart:!1},partNumbersList:[],subPartNumbersList:[],partNumbersAndSubPartNumbersList:[],warehousingHistories:[],shipmentList:[],warehousingList:[],isLoading:!0,isShowFastShippingWarehousingFormArea:!1}},methods:{fetchInitialWarehousingHistories(s){this.warehousingHistories=s},fetchIsShowFastShippingWarehousingFormArea(s){this.isShowFastShippingWarehousingFormArea=s},fetchInitialPartNumbers(s){this.partNumbersList=s},async fetchSubPartNumbers(){try{const{data:s,status:e,statusText:n}=await B.getSubPartNumbers();if(n!=="OK"&&e!==200)throw new Error;const{subPartNumbers:o}=s;this.subPartNumbersList=o,this.mergePartNumbersAndSubPartNumbersToList()}catch{y.fire({icon:"error",title:"載入資料錯誤，請稍後在試。"})}},mergePartNumbersAndSubPartNumbersToList(){this.partNumbersAndSubPartNumbersList=this.partNumbersList.concat(this.subPartNumbersList)},async handleSubmitWarehousing(){try{if(!this.verifyDataAfterSubmit())throw new Error("日期、品番號、數量不可空白");this.warehousingList.push(this.fetchPartNumberIdOrSubPartNumberId());const s=new FormData;s.append("warehousingList",JSON.stringify(this.warehousingList));const{data:e,statusText:n}=await T.Warehousing.create(s),o=e.status,r=e.message;if(o!=="success"&&n!=="OK")throw new Error(r||"入庫時發生錯誤，請稍後在試。");this.warehousingList=[],y.fire({icon:"success",title:"入庫資料登載成功"}),this.reload()}catch(s){y.fire({icon:"error",title:s||"拿取製程項目清單錯誤，請稍後再試。"})}},async handleSubmitShipping(){try{if(!this.verifyDataAfterSubmit())throw new Error("日期、品番號、數量不可空白");if(!this.checkPartOrSubPartQuantityToShip())throw new Error("數量不足以出貨，請檢查在庫量。");this.shipmentList.push(this.fetchPartNumberIdOrSubPartNumberId());const s=new FormData;s.append("shipmentList",JSON.stringify(this.shipmentList));const{data:e,statusText:n}=await T.Shipping.create(s),o=e.status,r=e.message;if(o!=="success"&&n!=="OK")throw new Error(r||"出貨時發生錯誤，請稍後在試。");this.shipmentList=[],y.fire({icon:"success",title:"出庫資料登載成功"}),this.reload()}catch(s){y.fire({icon:"error",title:s||"拿取製程項目清單錯誤，請稍後再試。"})}},verifyDataAfterSubmit(){if(this.newWarehousingOrShipping.date!==""&&this.newWarehousingOrShipping.name!==""&&Number(this.newWarehousingOrShipping.quantity)>0)return!0},fetchPartNumberIdOrSubPartNumberId(){try{for(let s of this.partNumbersList)if(s.name===this.newWarehousingOrShipping.name)return this.newWarehousingOrShipping.productId=s.id,this.newWarehousingOrShipping;for(let s of this.subPartNumbersList)if(s.name===this.newWarehousingOrShipping.name)return this.newWarehousingOrShipping.productId=s.id,this.newWarehousingOrShipping.isSubPart=!0,this.newWarehousingOrShipping}catch{y.fire({icon:"error",title:"取得不品ID時出現錯誤。"})}},checkPartOrSubPartQuantityToShip(){for(let s of this.partNumbersList)if(s.name===this.newWarehousingOrShipping.name)return s.quantity-Number(this.newWarehousingOrShipping.quantity)>=0;for(let s of this.subPartNumbersList)if(s.name===this.newWarehousingOrShipping.name)return s.quantity-Number(this.newWarehousingOrShipping.quantity)>=0},toggleShowFastShippingWarehousingFormArea(){this.$emit("after-click-toggle-fast-form-area")},fetchTodaysDate(){let s=new Date().getFullYear().toString(),e="",n="";new Date().getMonth()<9?e=`0${(new Date().getMonth()+1).toString()}`:e=(new Date().getMonth()+1).toString(),new Date().getDate()<10?n=`0${new Date().getDate().toString()}`:n=new Date().getDate().toString();const o=`${s}-${e}-${n}`;this.newWarehousingOrShipping.date=o}},watch:{initialWarehousingHistories(s){this.fetchInitialWarehousingHistories(s)},initialIsShowFastShippingWarehousingFormArea(s){this.fetchIsShowFastShippingWarehousingFormArea(s)},initialPartNumbers(s){this.fetchInitialPartNumbers(s)}}},ft={class:"histories_area"},bt={key:0,class:"view bg-dark mb-3 px-3"},wt={class:"d-flex justify-content-between align-items-center"},yt={class:"form-row"},St={class:"form-group col-md-3"},Nt={class:"form-group col-md-3"},vt={id:"partNumbers-list"},Pt=["value"],Ot={class:"form-group col-md-3"},Ft={class:"form-group col-md-3"},Dt={class:"table table-sm table-dark table-striped table-hover"},xt={scope:"row"},It={key:0,class:"text-dark",style:{"background-color":"#ea9d06"}},kt={key:1},_t={key:2,class:"bg-success"},At={key:3};function qt(s,e,n,o,r,u){return g((l(),c("div",ft,[r.isShowFastShippingWarehousingFormArea?(l(),c("div",bt,[t("div",wt,[e[7]||(e[7]=t("h1",{class:"text-white"},"新增",-1)),t("div",null,[t("button",{onClick:e[0]||(e[0]=M((...i)=>u.handleSubmitWarehousing&&u.handleSubmitWarehousing(...i),["stop","prevent"])),class:"btn btn-outline-warning mr-4"},"入庫"),t("button",{onClick:e[1]||(e[1]=M((...i)=>u.handleSubmitShipping&&u.handleSubmitShipping(...i),["stop","prevent"])),class:"btn btn-outline-success mr-4"},"出庫"),t("button",{onClick:e[2]||(e[2]=M((...i)=>u.toggleShowFastShippingWarehousingFormArea&&u.toggleShowFastShippingWarehousingFormArea(...i),["stop","prevent"])),class:"btn btn-outline-danger mr-2"},"Close")])]),t("div",yt,[t("div",St,[e[8]||(e[8]=t("label",{class:"add-form-label",for:"inputDate"},"日期",-1)),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>r.newWarehousingOrShipping.date=i),type:"date",class:"form-control",id:"inputDate"},null,512),[[O,r.newWarehousingOrShipping.date]])]),t("div",Nt,[e[9]||(e[9]=t("label",{class:"add-form-label",for:"inputNmae"},"品番號",-1)),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>r.newWarehousingOrShipping.name=i),list:"partNumbers-list",type:"text",class:"form-control",id:"inputName"},null,512),[[O,r.newWarehousingOrShipping.name]]),t("datalist",vt,[(l(!0),c(A,null,q(r.partNumbersAndSubPartNumbersList,i=>(l(),c("option",{key:i.index,value:i.name},null,8,Pt))),128))])]),t("div",Ot,[e[10]||(e[10]=t("label",{class:"add-form-label",for:"inputQuantity"},"數量",-1)),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>r.newWarehousingOrShipping.quantity=i),type:"number",class:"form-control",id:"inputQuantity",min:"0"},null,512),[[O,r.newWarehousingOrShipping.quantity]])]),t("div",Ft,[e[11]||(e[11]=t("label",{class:"add-form-label",for:"inputNote"},"備註",-1)),g(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>r.newWarehousingOrShipping.note=i),type:"text",class:"form-control",id:"inputNote",placeholder:"可空白..."},null,512),[[O,r.newWarehousingOrShipping.note]])])])])):U("",!0),t("table",Dt,[e[12]||(e[12]=t("thead",null,[t("tr",{class:"table-active",style:{"text-align":"center"}},[t("th",{scope:"col"},[t("h4",null,"日期")]),t("th",{scope:"col"},[t("h4",null,"品番")]),t("th",{scope:"col"},[t("h4",null,"入庫")]),t("th",{scope:"col"},[t("h4",null,"出庫")]),t("th",{scope:"col"},[t("h4",null,"餘存")]),t("th",{scope:"col"},[t("h4",null,"備註")])])],-1)),t("tbody",null,[(l(!0),c(A,null,q(r.warehousingHistories,i=>(l(),c("tr",{key:i.id,style:{"text-align":"center"}},[t("th",xt,h(i.textCreatedAt),1),t("td",null,h(i.PartNumber.name?i.PartNumber.name:i.SubPartNumber.name),1),i.quntityOfWarehousing?(l(),c("td",It,h(i.quntityOfWarehousing),1)):(l(),c("td",kt,h(i.quntityOfWarehousing),1)),i.quntityOfShipping?(l(),c("td",_t,h(i.quntityOfShipping),1)):(l(),c("td",At,h(i.quntityOfShipping),1)),t("td",null,h(i.totalQuntity),1),t("td",null,h(i.note),1)]))),128))])])],512)),[[D,!r.isLoading]])}const Wt=Q(gt,[["render",qt],["__scopeId","data-v-e1f56776"]]),Lt={props:{initialIsShowFastOutsourcingFormArea:{type:Boolean},initialPartNumbers:{type:Array}},created(){this.fetchPartNumbers(this.initialPartNumbers),this.fetchOutsourcingLists(),this.fetchPartnerFactories(),this.fetchProductionProcessItems(),this.fetchIsShowFastOutsourcingFormArea(this.initialIsShowFastOutsourcingFormArea),this.fetchTodaysDate(),this.isLoading=!1},data(){return{isLoading:!0,isShowFastOutsourcingFormArea:!1,isProcessing:!1,newOutsourcing:{actionDate:"",partNumberName:"",partnerFactoryName:"",productionProcessItemName:"",partNumberId:"",partnerFactoryId:"",productionProcessItemId:"",quantity:null,note:""},outsourcinglists:[],partnerFactories:[],partNumbers:[],productionProcessItems:[],subPartNumbers:[]}},methods:{async fetchOutsourcingLists(){try{const s=await T.Outsourcinglist.get(),{data:e,status:n,statusText:o}=s,{outsourcinglists:r}=e;if(o!=="OK"&&n!==200)throw new Error;if(e.status!=="success")throw new Error(e.message);r.map(u=>{u.actionDate=`${new Date(u.actionDate).getFullYear()}/${new Date(u.actionDate).getMonth()+1}/${new Date(u.actionDate).getDate()}`}),this.outsourcinglists=r}catch(s){y.fire({icon:"error",title:s||"外包清單載入錯誤，請稍後再試。"}),this.isLoading=!1}},async fetchPartnerFactories(){try{const{data:s,status:e,statusText:n}=await X.getAll(),{partnerFactories:o}=s;if(n!=="OK"&&e!==200)throw new Error;if(s.status!=="success")throw new Error(s.message);this.partnerFactories=o}catch(s){y.fire({icon:"error",title:s||"拿取協力商清單錯誤，請稍後再試。"})}},async fetchProductionProcessItems(){try{const{data:s,status:e,statusText:n}=await Z.getAll(),{productionProcessItems:o}=s;if(n!=="OK"&&e!==200)throw new Error;if(s.status!=="success")throw new Error(s.message);this.productionProcessItems=o}catch(s){y.fire({icon:"error",title:s||"拿取製程項目清單錯誤，請稍後再試。"})}},async handleSubmit(){try{this.isProcessing=!0;const s=(u,i)=>{let m=-1,N=this.partNumbers.length;for(;m+1!==N;){let f=Math.floor((m+N)/2);if(this.partNumbers[f].name===u){if(this.partNumbers[f].quantity-i<0)throw new Error(`"${u}" 數量不足以發外包`);return}else this.partNumbers[f].name<u?m=f:N=f}return{result:!1,message:"找不到此部品"}};if(!this.verifyDataAfterSubmit())throw new Error("日期、品番號、廠商、製程、數量不可空白");s(this.newOutsourcing.partNumberName,this.newOutsourcing.quantity),this.fetchAllItemIdAfterSubmit();const e=new FormData;e.append("outsourcinglist",JSON.stringify([this.newOutsourcing]));const{data:n,status:o,statusText:r}=await T.Outsourcinglist.create(e);if(o!==200&&r!=="OK")throw new Error;if(n.status!=="success")throw new Error(n.message);this.outsourcinglists.unshift(this.unshiftOutsourcingDataAfterSubmit(this.newOutsourcing,n.outsourcinglists[0])),this.$emit("after-submited-new",n.partNumbers[0],n.warehousingHistories[0],n.outsourcinglists[0].actionDate),this.newOutsourcing={...this.clearDataAfterSubmit()},this.fetchTodaysDate(),this.isProcessing=!1,y.fire({icon:"success",text:n.message})}catch(s){this.isProcessing=!1,y.fire({icon:"error",title:s||"拿取製程項目清單錯誤，請稍後再試。"})}},verifyDataAfterSubmit(){return this.newOutsourcing.actionDate!==""&&this.newOutsourcing.partNumberName!==""&&this.newOutsourcing.partnerFactoryName!==""&&this.newOutsourcing.productionProcessItemName!==""&&Number(this.newOutsourcing.quantity)>0},fetchAllItemIdAfterSubmit(){this.partNumbers.map(s=>{if(s.name===this.newOutsourcing.partNumberName)return this.newOutsourcing.partNumberId=s.id}),this.partnerFactories.map(s=>{if(s.name===this.newOutsourcing.partnerFactoryName)return this.newOutsourcing.partnerFactoryId=s.id}),this.productionProcessItems.map(s=>{if(s.processName===this.newOutsourcing.productionProcessItemName)return this.newOutsourcing.productionProcessItemId=s.id})},unshiftOutsourcingDataAfterSubmit(s,e){return{PartNumber:{id:s.partNumberId,name:s.partNumberName},PartnerFactory:{id:s.partnerFactoryId,name:s.partnerFactoryName},ProductionProcessItem:{id:s.productionProcessItemId,processName:s.productionProcessItemName},actionDate:`${new Date(e.actionDate).getFullYear()}/${new Date(e.actionDate).getMonth()+1}/${new Date(e.actionDate).getDate()}`,estimatedReturnDate:null,id:e.id,quantity:Number(s.quantity)}},clearDataAfterSubmit(){return{actionDate:"",partNumberName:"",partnerFactoryName:"",productionProcessItemName:"",partNumberId:"",partnerFactoryId:"",productionProcessItemId:"",quantity:null,note:""}},async deleteOutsourcing(s,e){try{const{data:n,status:o,statusText:r}=await T.Outsourcinglist.delete(s);if(r!=="OK"&&o!==200)throw new Error;if(n.status!=="success")throw new Error(n.message);this.$emit("outsourcing-delete",e),this.outsourcinglists=this.outsourcinglists.filter(u=>u.id!==s),y.fire({icon:"success",title:n.message})}catch(n){y.fire({icon:"error",title:n||"拿取製程項目清單錯誤，請稍後再試。"})}},async theOutsourcingIsDoneToSubmit(s,e){try{const n=await J.fire({inputValidator:f=>{if(!f)return"請輸入部品番!";if(!((w,b,x)=>{let I=-1,k=w.length;for(;I+1!==k;){let P=Math.floor((I+k)/2);if(w[P].name===x)return!0;w[P].name<x?I=P:w[P].name>x&&(k=P)}for(I=-1,k=b.length;I+1!==k;){let P=Math.floor((I+k)/2);if(b[P].name===x)return!0;b[P].name<x?I=P:b[P].name>x&&(k=P)}return null})(this.partNumbers,this.subPartNumbers,f))return"找不到此部品"}});if(!n.value)return;const o=new FormData;let u=(f=>{let v=-1,w=this.partNumbers.length;for(;v+1!==w;){let b=Math.floor((v+w)/2);if(this.partNumbers[b].name===f)return{id:this.partNumbers[b].id,isSub:!1};if(this.partNumbers[b].name<f){v=b;continue}if(this.partNumbers[b].name>f){w=b;continue}}for(v=-1,w=this.subPartNumbers.length;v+1!==w;){let b=Math.floor((v+w)/2);if(this.subPartNumbers[b].name===f)return{id:this.subPartNumbers[b].id,isSub:!0};if(this.subPartNumbers[b].name<f){v=b;continue}if(this.subPartNumbers[b].name>f){w=b;continue}}return null})(n.value);e.partNumberId=u.id,e.isSub=u.isSub,e.partNumberName=n.value,o.append("partNumberId",JSON.stringify(e.partNumberId)),o.append("quantity",JSON.stringify(e.quantity)),o.append("isSub",JSON.stringify(e.isSub));const{data:i,status:m,statusText:N}=await T.Outsourcinglist.done(s,o);if(N!=="OK"&&m!==200)throw new Error;if(i.status!=="success")throw new Error(i.message);this.outsourcinglists=this.outsourcinglists.filter(f=>f.id!==s),i.warehousingHistory.partNumberName=n.value,this.$emit("outsourcing-is-done-to-submit",e,i.warehousingHistory),y.fire({icon:"success",text:i.message})}catch(n){y.fire({icon:"error",title:n||"拿取製程項目清單錯誤，請稍後再試。"})}},fetchPartNumbers(s){this.partNumbers=s;for(let e of s)e.SubPartNumbers.length&&this.subPartNumbers.push(...e.SubPartNumbers)},fetchIsShowFastOutsourcingFormArea(s){this.isShowFastOutsourcingFormArea=s},toggleShowFastShippingWarehousingFormArea(){this.$emit("after-click-toggle-fast-form-area")},fetchTodaysDate(){let s=new Date().getFullYear().toString(),e="",n="";new Date().getMonth()<9?e=`0${(new Date().getMonth()+1).toString()}`:e=(new Date().getMonth()+1).toString(),new Date().getDate()<10?n=`0${new Date().getDate().toString()}`:n=new Date().getDate().toString();const o=`${s}-${e}-${n}`;this.newOutsourcing.actionDate=o}},watch:{initialIsShowFastOutsourcingFormArea(s){this.fetchIsShowFastOutsourcingFormArea(s)},initialPartNumbers(s){this.fetchPartNumbers(s)}}},$t={class:"histories_area"},Tt={class:"view bg-dark mb-3 px-3"},Ct={class:"d-flex justify-content-between align-items-center"},Mt=["disabled"],Et={class:"form-row"},Qt={class:"form-group col-md"},Vt={class:"form-group col-md"},Ut={id:"partNumber-list"},Bt=["value"],Kt={class:"form-row"},jt={class:"form-group col-md"},Yt={id:"partnerFactories-list"},Jt=["value"],Rt={class:"form-group col-md"},zt={id:"productionProcessItems-list"},Gt=["value"],Ht={class:"form-row"},Xt={class:"form-group col-md"},Zt={class:"form-row"},te={class:"form-group col-md"},ee={class:"table table-sm table-dark table-striped table-hover"},se={scope:"row"},ie={class:"d-flex justify-content-around"},re=["onClick"],ne=["onClick"];function ae(s,e,n,o,r,u){return g((l(),c("div",$t,[e[16]||(e[16]=t("div",{class:"tip-container t-flex t-items-center t-my-2"},[t("svg",{width:"20px",height:"20px",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",class:"iconify iconify--fxemoji",preserveAspectRatio:"xMidYMid meet",fill:"#000000"},[t("g",{id:"SVGRepo_bgCarrier","stroke-width":"0"}),t("g",{id:"SVGRepo_tracerCarrier","stroke-linecap":"round","stroke-linejoin":"round"}),t("g",{id:"SVGRepo_iconCarrier"},[t("path",{fill:"#FFB636",d:"M12.51 470.379L234.371 16.008c6.439-13.187 25.17-13.363 31.855-.299l232.51 454.371c6.064 11.849-2.542 25.92-15.853 25.92H28.512c-13.164 0-21.778-13.791-16.002-25.621z"}),t("path",{fill:"#2B3B47",d:"M284.332 173L272.15 336.498c-.911 12.233-11.567 21.411-23.8 20.499c-11.116-.828-19.706-9.707-20.499-20.499L215.668 173c-1.413-18.961 12.813-35.478 31.774-36.89s35.478 12.813 36.89 31.774c.124 1.662.109 3.5 0 5.116zM250 391.873c-17.432 0-31.564 14.131-31.564 31.564C218.436 440.869 232.568 455 250 455s31.564-14.131 31.564-31.564c0-17.432-14.132-31.563-31.564-31.563z"})])]),t("span",{class:"t-text-red-500 t-ml-2"}," 刪除外包項目後，會畫面處里異常，須 F5 重新整理。 (修復中...) ")],-1)),g(t("div",Tt,[t("div",Ct,[e[8]||(e[8]=t("h1",{class:"text-white"},"新增",-1)),t("div",null,[t("button",{onClick:e[0]||(e[0]=(...i)=>u.handleSubmit&&u.handleSubmit(...i)),class:"btn btn-outline-warning mr-4",disabled:r.isProcessing},h(r.isProcessing?"處理中...":"送出"),9,Mt),t("button",{onClick:e[1]||(e[1]=(...i)=>u.toggleShowFastShippingWarehousingFormArea&&u.toggleShowFastShippingWarehousingFormArea(...i)),class:"btn btn-outline-danger mr-2"},"Close")])]),t("div",Et,[t("div",Qt,[e[9]||(e[9]=t("label",{class:"add-form-label",for:"inputDate"},"日期",-1)),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>r.newOutsourcing.actionDate=i),type:"date",class:"form-control",id:"actionDate"},null,512),[[O,r.newOutsourcing.actionDate]])]),t("div",Vt,[e[10]||(e[10]=t("label",{class:"add-form-label",for:"inputNmae"},"品番號",-1)),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>r.newOutsourcing.partNumberName=i),list:"partNumber-list",type:"text",class:"form-control",id:"inputPartnerFactoryName"},null,512),[[O,r.newOutsourcing.partNumberName]]),t("datalist",Ut,[(l(!0),c(A,null,q(r.partNumbers,i=>(l(),c("option",{key:i.id,value:i.name},null,8,Bt))),128))])])]),t("div",Kt,[t("div",jt,[e[11]||(e[11]=t("label",{class:"add-form-label",for:"inputNmae"},"廠商",-1)),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>r.newOutsourcing.partnerFactoryName=i),list:"partnerFactories-list",type:"text",class:"form-control",id:"inputPartnerFactoryName"},null,512),[[O,r.newOutsourcing.partnerFactoryName]]),t("datalist",Yt,[(l(!0),c(A,null,q(r.partnerFactories,i=>(l(),c("option",{key:i.id,value:i.name},null,8,Jt))),128))])]),t("div",Rt,[e[12]||(e[12]=t("label",{class:"add-form-label",for:"inputNmae"},"製程",-1)),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>r.newOutsourcing.productionProcessItemName=i),list:"productionProcessItems-list",type:"text",class:"form-control",id:"inputProductionProcessItemName"},null,512),[[O,r.newOutsourcing.productionProcessItemName]]),t("datalist",zt,[(l(!0),c(A,null,q(r.productionProcessItems,i=>(l(),c("option",{key:i.id,value:i.processName},null,8,Gt))),128))])])]),t("div",Ht,[t("div",Xt,[e[13]||(e[13]=t("label",{class:"add-form-label",for:"inputQuantity"},"數量",-1)),g(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>r.newOutsourcing.quantity=i),newOutsourcing:"",type:"number",class:"form-control",id:"inputQuantity",min:"0"},null,512),[[O,r.newOutsourcing.quantity]])])]),t("div",Zt,[t("div",te,[e[14]||(e[14]=t("label",{class:"add-form-label",for:"inputNote"},"備註",-1)),g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>r.newOutsourcing.note=i),type:"text",class:"form-control",id:"inputNote",placeholder:"可空白..."},null,512),[[O,r.newOutsourcing.note]])])])],512),[[D,r.isShowFastOutsourcingFormArea]]),t("table",ee,[e[15]||(e[15]=t("thead",null,[t("tr",{class:"table-active",style:{"text-align":"center"}},[t("th",{scope:"col"},[t("h4",null,"發包日")]),t("th",{scope:"col"},[t("h4",null,"品番")]),t("th",{scope:"col"},[t("h4",null,"廠商")]),t("th",{scope:"col"},[t("h4",null,"製程")]),t("th",{scope:"col"},[t("h4",null,"數量")]),t("th",{scope:"col"},[t("h4",null,"備註")]),t("th",{scope:"col"},[t("h4",null,"操作")])])],-1)),t("tbody",null,[(l(!0),c(A,null,q(r.outsourcinglists,i=>(l(),c("tr",{key:i.id,style:{"text-align":"center"}},[t("th",se,h(i.actionDate),1),t("td",null,h(i.PartNumber.name?i.PartNumber.name:i.SubPartNumber.name),1),t("td",null,h(i.PartnerFactory.name),1),t("td",null,h(i.ProductionProcessItem.processName),1),t("td",null,h(i.quantity),1),t("td",null,h(i.note),1),t("td",null,[t("div",ie,[t("button",{onClick:M(m=>u.theOutsourcingIsDoneToSubmit(i.id,{partNumberId:i.PartNumber.id,quantity:i.quantity}),["stop","prevent"]),class:"btn btn-outline-success btn-sm"}," Done ",8,re),t("button",{onClick:M(m=>u.deleteOutsourcing(i.id,{partNumberId:i.PartNumber.id,quantity:i.quantity}),["stop","prevent"]),class:"btn btn-outline-danger btn-sm ml-3"}," Delete ",8,ne)])])]))),128))])])],512)),[[D,!r.isLoading]])}const oe=Q(Lt,[["render",ae],["__scopeId","data-v-ba2d28c8"]]),ue={class:"mt-3"},le={key:0},ce={key:1},he={class:"d-flex justify-content-center"},de={class:"form-row"},me={class:"col-auto"},pe={class:"col-auto"},ge={class:"col-auto"},fe={class:"t-mx-2 t-my-4"},be=["onClick"],we={class:"d-flex justify-content-around"},ye={style:{"flex-basis":"45%"}},Se={class:"mb-3",style:{"flex-basis":"50%"}},Ne={class:"d-flex justify-content-between align-items-center mb-2"},ve={class:"btn-group btn-group-toggle","data-toggle":"buttons"},Pe={__name:"HomePage",setup(s){const e=F([]),n=F([]),o=F([]),r=F(""),u=F(""),i=F(""),m=F(!0),N=F(!1),f=F(!1),v=F(!1),w=F(null),b=async d=>{try{if(w.value===d)return;w.value=d,m.value=!0;const a=await B.getPartNumbers({customerId:d}),{data:S,status:p,statusText:W}=a,{partNumbers:_,customers:j,warehousingHistories:Y}=S;if(W!=="OK"&&p!==200)throw new Error;e.value=_,n.value=j,o.value=Y,r.value="",u.value="",i.value="",m.value=!1}catch{y.fire({icon:"error",title:"載入錯誤，請稍後再試。"}),m.value=!1}},x=(d,a)=>{I(a);for(let S of e.value)if(S.name===d.partNumberName){S.quantity=S.quantity+Number(d.quantity);return}else for(let p of S.subPartNumbers)if(p.name===d.partNumberName){p.quantity=p.quantity+Number(d.quantity);return}},I=d=>{d&&(o.value.unshift({PartNumber:{name:d.partNumberName},note:d.note,quntityOfShipping:null,quntityOfWarehousing:d.quntityOfWarehousing,textCreatedAt:`${new Date(d.updatedAt).getFullYear()}/${new Date(d.updatedAt).getMonth()+1}/${new Date(d.updatedAt).getDate()}`,totalQuntity:d.totalQuntity}),o.value.pop())},k=(d,a,S)=>{let p=-1,W=e.value.length;for(;p+1!==W;){let _=Math.floor((p+W)/2);if(e.value[_].name===d.name){e.value[_].quantity=d.quantity;break}else e.value[_].name<d.name?p=_:W=_}o.value.unshift({PartNumber:{name:d.name},note:a.note,quntityOfShipping:a.quntityOfShipping,quntityOfWarehousing:null,textCreatedAt:`${new Date(S).getFullYear()}/${new Date(S).getMonth()+1}/${new Date(S).getDate()}`,totalQuntity:a.totalQuntity}),o.value.pop()},P=async()=>{try{const d={searchText:r.value,startDate:u.value,endDate:i.value};m.value=!0;const{data:a,status:S,statusText:p}=await B.getSearchPartNumbers(d);if(p!=="OK"&&S!==200)throw new Error;const{partNumbers:W,warehousingHistories:_}=a;e.value=W,o.value=_,m.value=!1}catch{y.fire({icon:"error",title:"載入錯誤，請稍後再試。"}),m.value=!1}};return R(()=>{b("")}),(d,a)=>{const S=z("router-link");return l(),c("div",ue,[m.value?(l(),c("div",le,[L(tt)])):U("",!0),m.value?U("",!0):(l(),c("div",ce,[t("form",he,[t("div",de,[t("div",me,[a[10]||(a[10]=t("p",{class:"text-light m-0"},"品番",-1)),g(t("input",{"onUpdate:modelValue":a[0]||(a[0]=p=>r.value=p),list:"partnumberList",type:"text",class:"form-control",name:"searchText",id:"searchText",placeholder:"搜尋番號",value:""},null,512),[[O,r.value]]),a[11]||(a[11]=t("datalist",{id:"partnumberList"},null,-1))]),t("div",pe,[a[12]||(a[12]=t("p",{class:"text-light m-0"},"開始",-1)),g(t("input",{"onUpdate:modelValue":a[1]||(a[1]=p=>u.value=p),type:"date",class:"form-control",name:"startDate",id:"startDate",value:""},null,512),[[O,u.value]])]),t("div",ge,[a[13]||(a[13]=t("p",{class:"text-light m-0"},"結束",-1)),g(t("input",{"onUpdate:modelValue":a[2]||(a[2]=p=>i.value=p),type:"date",class:"form-control",name:"endDate",id:"endDate",value:""},null,512),[[O,i.value]])]),t("div",{class:"col-auto align-self-end"},[t("button",{class:"t-bg-blue-500 t-text-white t-rounded t-h-[38px] t-w-[50px]",onClick:P},"搜尋")])])]),t("div",fe,[L(V(H),{"slides-per-view":"auto","space-between":5,"watch-overflow":!0},{default:C(()=>[L(V(K),{class:"!t-w-auto"},{default:C(()=>[t("div",{class:$(["t-customer-btn",{"t-active":!w.value||w.value===""}]),role:"button",onClick:a[3]||(a[3]=p=>b("",d.e))}," 全部 ",2)]),_:1}),(l(!0),c(A,null,q(n.value,p=>(l(),G(V(K),{key:p.id,class:"!t-w-auto"},{default:C(()=>[t("div",{class:$(["t-customer-btn",{"t-active":w.value===p.id}]),role:"button",onClick:W=>b(p.id)},h(p.name),11,be)]),_:2},1024))),128))]),_:1})]),t("section",we,[t("div",ye,[L(pt,{initialPartNumbers:e.value},null,8,["initialPartNumbers"])]),t("div",Se,[t("div",Ne,[t("div",ve,[t("label",{class:$(["btn btn-outline-light",{active:!N.value}])},[t("input",{onClick:a[4]||(a[4]=()=>N.value=!1),type:"radio",name:"options",id:"option1"}),a[14]||(a[14]=E(" 出入庫紀錄 "))],2),t("label",{class:$(["btn btn-outline-light",{active:N.value}])},[t("input",{onClick:a[5]||(a[5]=()=>N.value=!0),type:"radio",name:"options",id:"option3"}),a[15]||(a[15]=E(" 外包清單 "))],2)]),t("div",null,[g(t("div",null,[g(t("button",{onClick:a[6]||(a[6]=()=>f.value=!0),class:"btn btn-outline-warning mr-2"},"快速新增",512),[[D,!f.value]]),L(S,{to:{name:"warehouse-ShippingWarehousing"},class:"btn btn-info",role:"button"},{default:C(()=>a[16]||(a[16]=[E("新增出入庫")])),_:1})],512),[[D,!N.value]]),g(t("div",null,[g(t("button",{onClick:a[7]||(a[7]=()=>v.value=!0),class:"btn btn-outline-warning mr-2"},"快速新增",512),[[D,!v.value]]),L(S,{to:{name:"warehouse-outsourcing-new"},class:"btn btn-primary",role:"button"},{default:C(()=>a[17]||(a[17]=[E("新增外包")])),_:1})],512),[[D,N.value]])])]),g(L(Wt,{onAfterClickToggleFastFormArea:a[8]||(a[8]=()=>f.value=!1),"initial-warehousing-histories":o.value,"initial-part-numbers":e.value,"initial-is-show-fast-shipping-warehousing-form-area":f.value},null,8,["initial-warehousing-histories","initial-part-numbers","initial-is-show-fast-shipping-warehousing-form-area"]),[[D,!N.value]]),g(L(oe,{onOutsourcingDelete:x,onOutsourcingIsDoneToSubmit:x,onAfterSubmitedNew:k,onAfterClickToggleFastFormArea:a[9]||(a[9]=()=>v.value=!1),"initial-is-show-fast-outsourcing-form-area":v.value,"initial-part-numbers":e.value},null,8,["initial-is-show-fast-outsourcing-form-area","initial-part-numbers"]),[[D,N.value]])])])]))])}}},ke=Q(Pe,[["__scopeId","data-v-d92ee959"]]);export{ke as default};
