import{_ as C,T as g,B as _,C as E,c as l,k as y,i as u,b as e,e as d,w as h,v as w,t as p,F as x,h as P,o as c,g as b,E as k,n as T,q as B}from"./index-B3sZZ5VW.js";import{P as L}from"./PageLoader-DOfgM9bl.js";import{m as f}from"./managers-0bFA8U-L.js";const M={components:{PageLoader:L},name:"ManagerProductionProcessItems",created(){this.fetchProductionProcessItems(),this.isLoading=!1},data(){return{productionProcessItems:[],productionProcessItem:{name:""},isCreate:!1,isLoading:!0,isProcessing:!1}},methods:{async fetchProductionProcessItems(){try{const{data:i,status:t,statusText:r}=await f.productionProcessItems.getAll();if(r!=="OK"&&t!==200)throw new Error;if(i.status!=="success")throw new Error(i.message);this.productionProcessItems=i.productionProcessItems.map(n=>({...n,isEditing:!1,nameCached:""}))}catch{g.fire({icon:"error",title:"載入錯誤，請稍後再試。"}),this.isLoading=!1}},async createProductionProcessItem(i){try{if(this.isProcessing=!0,!this.productionProcessItem.name)throw new Error("名稱不可空白");const t=i.target,r=new FormData(t),{data:n}=await f.productionProcessItems.create(r);if(n.status==="error")throw new Error(n.message);n.productionProcessItem={...n.productionProcessItem,isEditing:!1,nameCached:""},this.productionProcessItems.push(n.productionProcessItem),this.productionProcessItem.name="",this.isProcessing=!1,g.fire({icon:"success",title:n.message})}catch(t){g.fire({icon:"error",title:t}),this.isProcessing=!1}},async deleteProductionProcessItem(i){try{if((await _.fire({showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",icon:"warning",title:"確定刪除?",text:"確定後，你將會刪除此製程。",confirmButtonText:"確定"})).value){const{data:r,statusText:n}=await f.productionProcessItems.delete(i);if(n!=="OK"&&status!==200)throw new Error;if(r.status!=="success")throw new Error(r.message);this.productionProcessItems=this.productionProcessItems.filter(o=>o.id!==i),E.fire("刪除！",`${r.message}`,"success")}}catch(t){g.fire({icon:"error",title:t})}},async updateProductionProcessItem(i,t,r){try{if(t===r){this.toggleIsEditing(i);return}if(t==="")throw new Error("請填入名稱");const{data:n,statusText:o}=await f.productionProcessItems.update(i,{name:t});if(o!=="OK"&&status!==200)throw new Error(n.message);if(n.status!=="success")throw new Error(n.message);g.fire({icon:"success",title:n.message}),this.toggleIsEditing(i)}catch(n){g.fire({icon:"error",title:n})}},createToggle(){this.isCreate=!this.isCreate},toggleIsEditing(i){this.productionProcessItems.map(t=>{t.id===i&&(t.isEditing=!t.isEditing,t.nameCached=t.processName),t.id!==i&&(t.isEditing=!1)})},cancelIsEditing(i){this.productionProcessItems.map(t=>{t.id===i&&(t.isEditing=!t.isEditing,t.processName=t.nameCached)})}}},V={class:"mt-5 container"},z={key:0},N={key:1},I={class:"mb-2"},K={class:"input-group input-group-sm d-flex align-items-center text_input_box mr-1"},D=["disabled"],H={class:"table table-striped table-dark"},A={scope:"row"},F=["onUpdate:modelValue","onKeydown"],O={key:0,class:"d-flex"},S=["onClick"],U=["onClick"],q={key:1,class:"d-flex"},j=["onClick"],G=["onClick"];function J(i,t,r,n,o,a){const v=B("PageLoader");return c(),l("div",V,[o.isLoading?(c(),l("div",z,[y(v)])):u("",!0),o.isLoading?u("",!0):(c(),l("div",N,[e("div",I,[o.isCreate?(c(),l("form",{key:0,onSubmit:t[2]||(t[2]=d((...s)=>a.createProductionProcessItem&&a.createProductionProcessItem(...s),["stop","prevent"])),class:"d-flex justify-content-start"},[t[4]||(t[4]=e("div",{class:"d-flex align-items-center"},[e("span",{class:"text-light"},"製程名稱：")],-1)),e("div",K,[h(e("input",{type:"text",class:"form-control",name:"name",id:"name","onUpdate:modelValue":t[0]||(t[0]=s=>o.productionProcessItem.name=s),required:""},null,512),[[w,o.productionProcessItem.name]])]),e("button",{type:"submit",class:"btn btn-primary",disabled:o.isProcessing},p(o.isProcessing?"處理中...":"送出"),9,D),e("button",{onClick:t[1]||(t[1]=d((...s)=>a.createToggle&&a.createToggle(...s),["stop","prevent"])),type:"button",class:"btn btn-outline-danger ml-1"},"取消")],32)):u("",!0),o.isCreate?u("",!0):(c(),l("button",{key:1,onClick:t[3]||(t[3]=d((...s)=>a.createToggle&&a.createToggle(...s),["stop","prevent"])),type:"button",class:"btn btn-outline-light"},"+新增製程"))]),e("table",H,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"col_1"},"#"),e("th",{scope:"col"},"製程名稱"),e("th",{scope:"col",class:"col_3"},"操作")])],-1)),e("tbody",null,[(c(!0),l(x,null,P(o.productionProcessItems,s=>(c(),l("tr",{key:s.id},[e("th",A,p(s.id),1),e("td",null,[h(e("div",null,p(s.processName),513),[[b,!s.isEditing]]),h(e("input",{"onUpdate:modelValue":m=>s.processName=m,onKeydown:k(m=>a.toggleIsEditing(s.id),["esc"]),type:"text",class:"form-control form-control-sm m-auto editing_input",ref_for:!0,ref:s.id,name:"name",id:"name"},null,40,F),[[b,s.isEditing],[w,s.processName]])]),e("td",null,[s.isEditing?u("",!0):(c(),l("div",O,[e("button",{onClick:d(m=>a.toggleIsEditing(s.id),["stop","prevent"]),class:T(["btn btn-outline-warning btn-sm",[{active:s.isEditing}]])},t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-gear-fill",viewBox:"0 0 16 16"},[e("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"})],-1)]),10,S),e("button",{onClick:d(m=>a.deleteProductionProcessItem(s.id),["stop","prevent"]),class:"btn btn-outline-danger btn-sm ml-2"},t[6]||(t[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-trash-fill",viewBox:"0 0 16 16"},[e("path",{d:"M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"})],-1)]),8,U)])),s.isEditing?(c(),l("div",q,[e("button",{onClick:d(m=>a.updateProductionProcessItem(s.id,s.processName,s.nameCached),["stop","prevent"]),class:"btn btn-outline-success btn-sm"}," Done ",8,j),e("button",{onClick:d(m=>a.cancelIsEditing(s.id),["stop","prevent"]),class:"btn btn-outline-danger btn-sm ml-3"}," Cancel ",8,G)])):u("",!0)])]))),128))])])]))])}const X=C(M,[["render",J],["__scopeId","data-v-149ad976"]]);export{X as default};
