import{_,T as w,C as y,D,E as N,w as m,l as g,c as h,b as t,d as c,v as p,F as b,m as f,t as l,s as S,o as d}from"./index-DnqVUwQ5.js";import{p as I,w as L}from"./warehouse-CExsAq7Z.js";const P={name:"ShippingWarehousing",created(){this.fetchTodaysDate(),this.fetchPartNumbers(),this.fetchSubPartNumbers(),this.isLoading=!this.isLoading},data(){return{partNumbersList:[],subPartNumbersList:[],newItem:{productId:"",date:"",name:"",quantity:"",note:"",isSubPart:!1},shipmentList:[],warehousingList:[],isProcessing:!1,isLoading:!0}},methods:{async fetchPartNumbers(){try{const{data:n,status:e,statusText:o}=await I.getPartNumbers();if(o!=="OK"&&e!==200)throw new Error;const{partNumbers:a}=n;this.partNumbersList=a}catch{w.fire({icon:"error",title:"載入資料錯誤，請稍後在試。"})}},async fetchSubPartNumbers(){try{const{data:n,status:e,statusText:o}=await I.getSubPartNumbers();if(o!=="OK"&&e!==200)throw new Error;const{subPartNumbers:a}=n;this.subPartNumbersList=a}catch{w.fire({icon:"error",title:"載入資料錯誤，請稍後在試。"})}},fetchTodaysDate(){let n=new Date().getFullYear().toString(),e="",o="";new Date().getMonth()<9?e=`0${(new Date().getMonth()+1).toString()}`:e=(new Date().getMonth()+1).toString(),new Date().getDate()<10?o=`0${new Date().getDate().toString()}`:o=new Date().getDate().toString();const a=`${n}-${e}-${o}`;this.newItem.date=a},async addNewItem(n){try{const{date:e,name:o,quantity:a}=this.newItem;if(!e||!o||!a){y.fire({icon:"warning",title:"日、品番號、數量不可空白"});return}let s=!1;if(this.partNumbersList.map(r=>{if(r.name===this.newItem.name){this.newItem.productId=r.id;const{subPartNumbers:i}=r;if(i.length){for(const u of i)if(!u.usagePerUnit>0)throw new Error(`${r.name} 其子部品 ${u.name} 尚未設定每單位使用量`)}s=!0}}),this.subPartNumbersList.map(r=>{r.name===this.newItem.name&&(this.newItem.productId=r.id,this.newItem.isSubPart=!0,s=!0)}),!s)throw new Error("此品番不存在");if(n==="warehousing"){this.warehousingList.push({...this.newItem}),this.newItem.productId="",this.newItem.name="",this.newItem.quantity="",this.newItem.note="",this.newItem.isSubPart=!1;return}if(n==="shipping"){this.shipmentList.push({...this.newItem}),this.newItem.productId="",this.newItem.name="",this.newItem.quantity="",this.newItem.note="",this.newItem.isSubPart=!1;return}}catch(e){y.fire({icon:"error",title:e||"發生不明錯誤!"})}},async removeItem(n,e){try{if(n==="warehousingList"){this.warehousingList.splice(e,1);return}if(n==="shipmentList"){this.shipmentList.splice(e,1);return}}catch{w.fire({icon:"error",title:"錯誤，再試一次。"})}},async handleSubmit(){try{if(this.isProcessing=!0,this.warehousingList.length){const n=new FormData;n.append("warehousingList",JSON.stringify(this.warehousingList));const{data:e,statusText:o}=await L.Warehousing.create(n),a=e.status,s=e.message;if(console.log(a),a!=="success"&&o!=="OK")throw new Error(s||"入庫時發生錯誤，請稍後在試。");this.warehousingList=[]}if(this.shipmentList.length){const n=new FormData;n.append("shipmentList",JSON.stringify(this.shipmentList));const{data:e,statusText:o}=await L.Shipping.create(n),a=e.status,s=e.message;if(a!=="success"&&o!=="OK")throw new Error(s||"出貨時發生錯誤，請稍後在試。");this.shipmentList=[]}D.fire({title:"成功",text:"資料登載成功"}),this.isProcessing=!1}catch(n){N.fire({title:"Oops...",text:n.message}),this.isProcessing=!1}}}},k={class:"view bg-dark p-3"},x={class:"bg-dark mb-3 px-3"},T={class:"d-flex justify-content-between align-items-center"},C={class:"form-row"},E={class:"form-group col-md-3"},q={class:"form-group col-md-3"},M={id:"partNumbers-list"},F=["value"],O={class:"form-group col-md-3"},V={class:"form-group col-md-3"},W={class:"mt-5"},B={class:"table table-hover table-striped table-dark"},U={style:{width:"1%"}},K=["onClick"],j={style:{width:"1%"},scope:"row"},A={style:{width:"10%"}},J={style:{width:"15%"}},Q={style:{width:"10%"}},X={class:"mt-5"},Y={class:"table table-hover table-striped table-dark"},z={style:{width:"1%"}},G=["onClick"],H={style:{width:"1%"},scope:"row"},R={style:{width:"10%"}},Z={style:{width:"15%"}},$={style:{width:"10%"}},tt={key:0,class:"d-flex justify-content-end"},et=["disabled"];function st(n,e,o,a,s,r){return m((d(),h("div",k,[t("div",x,[t("div",T,[e[7]||(e[7]=t("h1",{class:"text-white"},"新增",-1)),t("div",null,[t("button",{onClick:e[0]||(e[0]=c(i=>r.addNewItem("warehousing"),["stop","prevent"])),class:"btn btn-outline-warning mr-4"},"入庫"),t("button",{onClick:e[1]||(e[1]=c(i=>r.addNewItem("shipping"),["stop","prevent"])),class:"btn btn-outline-success mr-4"},"出庫")])]),t("div",C,[t("div",E,[e[8]||(e[8]=t("label",{class:"add-form-label",for:"inputDate"},"日期",-1)),m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>s.newItem.date=i),type:"date",class:"form-control",id:"inputDate"},null,512),[[p,s.newItem.date]])]),t("div",q,[e[9]||(e[9]=t("label",{class:"add-form-label",for:"inputNmae"},"品番號",-1)),m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>s.newItem.name=i),list:"partNumbers-list",type:"text",class:"form-control",id:"inputName"},null,512),[[p,s.newItem.name]]),t("datalist",M,[(d(!0),h(b,null,f(s.partNumbersList,i=>(d(),h("option",{key:i.id,value:i.name},null,8,F))),128))])]),t("div",O,[e[10]||(e[10]=t("label",{class:"add-form-label",for:"inputQuantity"},"數量",-1)),m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>s.newItem.quantity=i),type:"number",class:"form-control",id:"inputQuantity"},null,512),[[p,s.newItem.quantity]])]),t("div",V,[e[11]||(e[11]=t("label",{class:"add-form-label",for:"inputNote"},"備註",-1)),m(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>s.newItem.note=i),type:"text",class:"form-control",id:"inputNote",placeholder:"可空白..."},null,512),[[p,s.newItem.note]])])])]),t("div",null,[m(t("div",W,[e[13]||(e[13]=t("h1",{class:"text-dark bg-warning m-0"},"入庫",-1)),t("table",B,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",{scope:"col"}),t("th",{scope:"col"},"#"),t("th",{scope:"col"},"日期"),t("th",{scope:"col"},"品番"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"備註")])],-1)),t("tbody",null,[(d(!0),h(b,null,f(s.warehousingList,(i,u)=>(d(),h("tr",{key:u},[t("td",U,[t("button",{onClick:c(v=>r.removeItem("warehousingList",u),["stop","prevent"]),class:"btn btn-outline-danger btn-sm rounded-circle"}," X ",8,K)]),t("th",j,l(u+1),1),t("td",A,l(i.date),1),t("td",J,l(i.name),1),t("td",Q,l(i.quantity),1),t("td",null,l(i.note),1)]))),128))])])],512),[[g,s.warehousingList.length>0]]),m(t("div",X,[e[15]||(e[15]=t("h1",{class:"text-white bg-success m-0"},"出庫",-1)),t("table",Y,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",{scope:"col"}),t("th",{scope:"col"},"#"),t("th",{scope:"col"},"日期"),t("th",{scope:"col"},"品番"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"備註")])],-1)),t("tbody",null,[(d(!0),h(b,null,f(s.shipmentList,(i,u)=>(d(),h("tr",{key:u},[t("td",z,[t("button",{onClick:c(v=>r.removeItem("shipmentList",u),["stop","prevent"]),class:"btn btn-outline-danger btn-sm rounded-circle"}," X ",8,G)]),t("th",H,l(u+1),1),t("td",R,l(i.date),1),t("td",Z,l(i.name),1),t("td",$,l(i.quantity),1),t("td",null,l(i.note),1)]))),128))])])],512),[[g,s.shipmentList.length>0]])]),s.shipmentList.length>0||s.warehousingList.length>0?(d(),h("div",tt,[t("button",{onClick:e[6]||(e[6]=c((...i)=>r.handleSubmit&&r.handleSubmit(...i),["stop","prevent"])),type:"submit",class:"btn btn-primary",disabled:s.isProcessing},l(s.isProcessing?"處理中...":"送出"),9,et)])):S("",!0)],512)),[[g,!s.isLoading]])}const ot=_(P,[["render",st],["__scopeId","data-v-d8ad5af2"]]);export{ot as default};
